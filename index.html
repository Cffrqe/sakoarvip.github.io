<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Sakoar Interactive - Gaming & Esports Platform</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo" onclick="window.location.href='index.html'">Sakoar</div>
            <div class="nav-links">
                <a href="browse-leagues.html" class="nav-link">Browse Leagues</a>
                <a href="dashboard.html" class="nav-link user-dependent" style="display: none;">Dashboard</a>
                <div class="guest-dependent" style="display: flex; gap: 15px;">
                    <button class="btn btn-secondary" id="loginBtn">Login</button>
                    <button class="btn btn-primary" id="signupBtn">Sign Up</button>
                </div>
                <div class="user-menu user-dependent" style="display: none;">
                    <img src="default-avatar.png" class="user-avatar" alt="User Avatar">
                    <div class="dropdown">
                        <a href="dashboard.html" class="dropdown-item">Dashboard</a>
                        <a href="edit-profile.html" class="dropdown-item">Edit Profile</a>
                        <a href="leagues.html" class="dropdown-item">My Leagues</a>
                        <a href="rosters.html" class="dropdown-item">My Rosters</a>
                        <a href="#" class="dropdown-item logoutBtn">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="hero" id="home">
        <div class="hero-content">
            <h1 class="logo">Sakoar Interactive</h1>
            <p class="tagline">Create, Compete, Inspire.</p>
            <div class="cta-buttons">
                <button class="btn btn-primary" id="getStartedBtn" style="padding: 18px 50px; font-size: 1.2em;">Get Started</button>
                <a href="browse-leagues.html" class="btn btn-secondary" style="padding: 18px 50px; font-size: 1.2em;">Explore Leagues</a>
            </div>
        </div>
    </div>
    
    <div class="modal" id="loginModal">
        <div class="modal-content card">
            <span class="modal-close" id="closeLogin">&times;</span>
            <h2 class="page-title" style="text-align: center; margin-bottom: 30px;">Welcome Back</h2>
            <div id="loginAlert"></div>
            <form id="loginForm">
                <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="loginEmail" required></div>
                <div class="form-group"><label class="form-label">Password</label><input type="password" class="form-input" id="loginPassword" required></div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
            </form>
            <div class="form-toggle" style="text-align: center; margin-top: 20px;">Don't have an account? <a href="#" id="switchToSignup" style="color: #8b5cf6; font-weight: 600;">Sign up</a></div>
        </div>
    </div>

    <div class="modal" id="signupModal">
        <div class="modal-content card">
            <span class="modal-close" id="closeSignup">&times;</span>
            <h2 class="page-title" style="text-align: center; margin-bottom: 30px;">Join Sakoar</h2>
            <div id="signupAlert"></div>
            <form id="signupForm">
                <div class="form-group"><label class="form-label">Username</label><input type="text" class="form-input" id="signupUsername" required></div>
                <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="signupEmail" required></div>
                <div class="form-group"><label class="form-label">Password</label><input type="password" class="form-input" id="signupPassword" required minlength="6"></div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Sign Up</button>
            </form>
            <div class="form-toggle" style="text-align: center; margin-top: 20px;">Already have an account? <a href="#" id="switchToLogin" style="color: #8b5cf6; font-weight: 600;">Login</a></div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    
    <!-- Local Scripts -->
    <script src="firebase-config.js"></script>
    <script src="auth.js"></script>

    <script>
        // --- Modal Control Logic ---
        const loginModal = document.getElementById('loginModal');
        const signupModal = document.getElementById('signupModal');
        const loginBtn = document.getElementById('loginBtn');
        const signupBtn = document.getElementById('signupBtn');
        const closeLoginBtn = document.getElementById('closeLogin');
        const closeSignupBtn = document.getElementById('closeSignup');
        const switchToSignupLink = document.getElementById('switchToSignup');
        const switchToLoginLink = document.getElementById('switchToLogin');
        const getStartedBtn = document.getElementById('getStartedBtn');

        const openModal = (modal) => modal.style.display = 'flex';
        const closeModal = (modal) => modal.style.display = 'none';

        if (loginBtn) loginBtn.addEventListener('click', () => openModal(loginModal));
        if (signupBtn) signupBtn.addEventListener('click', () => openModal(signupModal));
        if (closeLoginBtn) closeLoginBtn.addEventListener('click', () => closeModal(loginModal));
        if (closeSignupBtn) closeSignupBtn.addEventListener('click', () => closeModal(signupModal));
        if (getStartedBtn) {
            getStartedBtn.addEventListener('click', () => {
                auth.currentUser ? window.location.href = 'dashboard.html' : openModal(signupModal);
            });
        }
        
        // Switch between login and signup modals
        switchToSignupLink.addEventListener('click', (e) => { 
            e.preventDefault(); 
            closeModal(loginModal); 
            openModal(signupModal); 
        });
        switchToLoginLink.addEventListener('click', (e) => { 
            e.preventDefault(); 
            closeModal(signupModal); 
            openModal(loginModal); 
        });

        // Close modal if clicking on the background
        window.addEventListener('click', (e) => {
            if (e.target === loginModal) closeModal(loginModal);
            if (e.target === signupModal) closeModal(signupModal);
        });


        // --- Firebase Authentication Logic ---
        const signupForm = document.getElementById('signupForm');
        signupForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('signupUsername').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;

            // Basic validation
            if (!username || !email || !password) {
                 showAlert('signupAlert', 'All fields are required.', 'error');
                 return;
            }

            auth.createUserWithEmailAndPassword(email, password)
                .then(userCredential => {
                    const user = userCredential.user;
                    // Set a default profile picture URL or leave it null
                    const defaultAvatar = 'default-avatar.png';
                    // Update Firebase Auth profile
                    return user.updateProfile({
                        displayName: username,
                        photoURL: defaultAvatar
                    }).then(() => {
                        // Create a user document in Firestore
                        return db.collection('users').doc(user.uid).set({
                            username: username,
                            email: email,
                            uid: user.uid,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            photoURL: defaultAvatar
                        });
                    });
                })
                .then(() => {
                    showAlert('signupAlert', 'Account created! Redirecting...', 'success');
                    setTimeout(() => window.location.href = 'dashboard.html', 1500);
                })
                .catch(error => showAlert('signupAlert', error.message, 'error'));
        });

        const loginForm = document.getElementById('loginForm');
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            auth.signInWithEmailAndPassword(email, password)
                .then(() => {
                    showAlert('loginAlert', 'Login successful! Redirecting...', 'success');
                    setTimeout(() => window.location.href = 'dashboard.html', 1500);
                })
                .catch(error => showAlert('loginAlert', error.message, 'error'));
        });
    </script>
</body>
</html>
