<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Leagues - Sakoar</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Add styles from your original leagues.html to styles.css -->
</head>
<body>
    <nav class="navbar">
        <!-- ... (Same navbar as dashboard.html) ... -->
    </nav>

    <div class="leagues-container">
        <div class="page-header">
            <h1 class="page-title">My Leagues</h1>
            <a href="create-league.html" class="btn btn-primary">+ Create League</a>
        </div>
        <div id="leaguesGrid" class="leagues-grid">
             <!-- Loading state -->
            <p id="loadingState" style="color: #94a3b8; font-size: 1.2em;">Loading your leagues...</p>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>
    <script src="auth.js"></script>
    <script>
        auth.onAuthStateChanged(user => {
            if (user) {
                loadUserLeagues(user.uid);
            } else {
                window.location.href = 'index.html';
            }
        });

        async function loadUserLeagues(userId) {
            const leaguesGrid = document.getElementById('leaguesGrid');
            const loadingState = document.getElementById('loadingState');

            const leaguesRef = db.collection('leagues');
            const query = leaguesRef.where('memberIds', 'array-contains', userId).orderBy('createdAt', 'desc');
            
            try {
                const snapshot = await query.get();
                loadingState.style.display = 'none';

                if (snapshot.empty) {
                    leaguesGrid.innerHTML = `
                        <div class="empty-state" style="grid-column: 1 / -1;">
                            <div class="empty-icon">üèÜ</div>
                            <div class="empty-text">You haven't created or joined any leagues yet.</div>
                            <a href="browse-leagues.html" class="btn btn-primary">Browse Public Leagues</a>
                        </div>`;
                    return;
                }

                let leaguesHTML = '';
                snapshot.forEach(doc => {
                    const league = doc.data();
                    const isOwner = league.creatorId === userId;
                    leaguesHTML += `
                        <div class="league-card" onclick="window.location.href='league-details.html?id=${doc.id}'" style="cursor: pointer;">
                            <div class="league-header">
                                <div class="league-icon">${league.icon}</div>
                                <div class="league-info">
                                    <div class="league-name">${league.name} ${isOwner ? '<span style="font-size: 0.7em; color: #8b5cf6;">(Owner)</span>' : ''}</div>
                                    <div class="league-game">${league.game}</div>
                                    <span class="league-status status-${league.status}">${league.status.replace('-', ' ')}</span>
                                </div>
                            </div>
                            <p class="league-description">${league.description}</p>
                            <div class="league-stats">
                                <div class="stat-item">
                                    <div class="stat-value">${league.memberIds.length}</div>
                                    <div class="stat-label">Members</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${league.creatorUsername}</div>
                                    <div class="stat-label">Creator</div>
                                </div>
                            </div>
                        </div>`;
                });
                leaguesGrid.innerHTML = leaguesHTML;

            } catch (error) {
                loadingState.textContent = 'Error loading leagues.';
                console.error("Error fetching leagues: ", error);
            }
        }
    </script>
</body>
</html>
